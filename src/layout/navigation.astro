---
import Rss from '../components/icons/rss.astro';
import Menu from '../components/icons/menu.astro';
import '../styles/global.css'
---

<header
    class='bg-bgLight dark:bg-bgDark
    h-16 w-full pl-6 pr-6 pt-4 pb-4 mb-1 flex justify-between items-center
    z-50'
>
    <div class='flex items-center'>
        <a href='/' class='md:text-5xl text-3xl font-bold whitespace-nowrap'>
            <span class='text-phBlack dark:text-phWhite' style="font-family: 'Poor Story', sans-serif;"> 말랑누오의 </span>
            <span
                class='bg-phBlue rounded-md pt-1 pl-2 pr-2 pb-1 text-phWhite dark:text-phBlack' style="font-family: 'Poor Story', sans-serif;"
            >
                기록
            </span>
        </a>
        <a href='/rss' class='ml-1 flex-shrink-0 self-start'>
            <Rss
                class='text-fontLight dark:text-fontDark md:h-6 md:w-6 h-5 w-5'
            />
        </a>
    </div>

    {/* Desktop Navigation */}
    <nav class='text-fontLight dark:text-fontDark text-xl hidden md:block'>
        <ul class='flex'>
            <li class='inline-flex flex-initial p-2 mr-2'>
                <a href='/'>Blogs</a>
            </li>
            <li class='inline-flex flex-initial p-2 mr-2'>
                <a href='/tags'>Tags</a>
            </li>
            <li class='inline-flex flex-initial p-2'>
                <a href="https://portfolio.malangnuo.com/" rel="noopener noreferrer">About</a>
            </li>
        </ul>
    </nav>

    {/* Mobile Menu Button */}
    <button
        id='mobile-menu-button'
        class='md:hidden text-fontLight dark:text-fontDark p-2'
        aria-label='Open menu'
    >
        <Menu class='h-6 w-6' />
    </button>

    {/* Mobile Menu Dropdown */}
    <div
        id='mobile-menu'
        class='md:hidden hidden absolute top-16 right-0 bg-bgLight dark:bg-bgDark shadow-lg rounded-b-lg border border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300 ease-in-out'
        style='opacity: 0; transform: translateY(-10px);'
    >
        <nav class='text-fontLight dark:text-fontDark text-lg p-4'>
            <ul class='flex flex-col space-y-2'>
                <li>
                    <a href='/' class='block p-3 rounded-lg hover:bg-phBlue hover:text-phWhite dark:hover:text-phBlack transition-all duration-200 hover:pl-4 hover:shadow-md'>Blogs</a>
                </li>
                <li>
                    <a href='/tags' class='block p-3 rounded-lg hover:bg-phBlue hover:text-phWhite dark:hover:text-phBlack transition-all duration-200 hover:pl-4 hover:shadow-md'>Tags</a>
                </li>
                <li>
                    <a href="https://portfolio.malangnuo.com" rel="noopener noreferrer" class='block p-3 rounded-lg hover:bg-phBlue hover:text-phWhite dark:hover:text-phBlack transition-all duration-200 hover:pl-4 hover:shadow-md'>About</a>
                </li>
            </ul>
        </nav>
    </div>
</header>

<script>
    const menuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    let isMenuOpen = false;

    const openMenu = () => {
        if (!mobileMenu) return;
        mobileMenu.classList.remove('hidden');
        // Trigger reflow
        void mobileMenu.offsetWidth;
        mobileMenu.style.opacity = '1';
        mobileMenu.style.transform = 'translateY(0)';
        isMenuOpen = true;
    };

    const closeMenu = () => {
        if (!mobileMenu) return;
        mobileMenu.style.opacity = '0';
        mobileMenu.style.transform = 'translateY(-10px)';
        setTimeout(() => {
            if (!isMenuOpen) {
                mobileMenu.classList.add('hidden');
            }
        }, 300);
        isMenuOpen = false;
    };

    menuButton?.addEventListener('click', () => {
        if (isMenuOpen) {
            closeMenu();
        } else {
            openMenu();
        }
    });

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
        const target = e.target as Node;
        if (menuButton && mobileMenu && !menuButton.contains(target) && !mobileMenu.contains(target)) {
            closeMenu();
        }
    });

    // Close menu when clicking a link
    mobileMenu?.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
            closeMenu();
        });
    });
</script>
